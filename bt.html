<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bluetooth GPS Olvasó - PX1122R nevelemzéssel</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0d3b66 0%, #1a5f7a 100%);
            color: #f8f9fa;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .card {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }
        
        .card-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #4ecdc4;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn {
            display: inline-block;
            background: linear-gradient(to right, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-align: center;
            margin-top: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-danger {
            background: linear-gradient(to right, #ff6b6b, #ee5a52);
        }
        
        .btn-warning {
            background: linear-gradient(to right, #ffc107, #e0a800);
        }
        
        .data-display {
            margin-top: 20px;
        }
        
        .data-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .data-label {
            font-weight: 600;
            color: #a5d8ff;
        }
        
        .data-value {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: #ffd166;
            max-width: 60%;
            overflow-wrap: break-word;
            text-align: right;
        }
        
        .hex-dump {
            background-color: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .hex-line {
            margin-bottom: 5px;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .hex-address {
            color: #4ecdc4;
            display: inline-block;
            width: 40px;
        }
        
        .hex-bytes {
            color: #ffd166;
            margin: 0 10px;
        }
        
        .hex-ascii {
            color: #81c784;
        }
        
        .analysis-result {
            background-color: rgba(255, 215, 102, 0.1);
            border-left: 4px solid #ffd166;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .device-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .info-box {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
        }
        
        .info-box h4 {
            color: #4ecdc4;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .device-info-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2.2rem;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-bug"></i> Bluetooth Eszköznév Elemző</h1>
            <p class="subtitle">PX1122R GPS modul nevének elemzése - Miért lát Android és Web API eltérő nevet?</p>
        </header>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-satellite"></i> PX1122R GPS Modul Elemzése</h2>
            
            <div class="analysis-result">
                <h3><i class="fas fa-lightbulb"></i> Elemzés eredménye</h3>
                <p><strong>Android által látott név:</strong> <span style="color: #81c784;">PXEB_FB13BDD6</span></p>
                <p><strong>Web Bluetooth API által látott név:</strong> <span style="color: #ffd166;">GR-AC_10001_09_7e73_SC</span></p>
                
                <p style="margin-top: 10px;"><strong>Valószínű magyarázat:</strong> A modul különböző Bluetooth reklámadatokban küldi a nevét. Az Android a "Complete Local Name"-t jeleníti meg, míg a Web API a reklámcsomagokban található rövidített nevet.</p>
            </div>
            
            <div class="device-info-grid">
                <div class="info-box">
                    <h4><i class="fas fa-android"></i> Android névelemzés</h4>
                    <p><strong>PXEB_FB13BDD6</strong></p>
                    <ul style="padding-left: 20px; margin-top: 10px;">
                        <li>PXEB = PX1122R modul azonosító</li>
                        <li>FB13BDD6 = Bluetooth MAC cím utolsó 8 karaktere</li>
                        <li>Ez a teljes eszköznév</li>
                    </ul>
                </div>
                
                <div class="info-box">
                    <h4><i class="fas fa-globe"></i> Web API névelemzés</h4>
                    <p><strong>GR-AC_10001_09_7e73_SC</strong></p>
                    <ul style="padding-left: 20px; margin-top: 10px;">
                        <li>GR-AC = Gyártó/model azonosító</li>
                        <li>10001_09 = Firmware/szoftver verzió</li>
                        <li>7e73 = MAC cím része</li>
                        <li>SC = Serial Communication</li>
                    </ul>
                </div>
                
                <div class="info-box">
                    <h4><i class="fas fa-microchip"></i> PX1122R Modul Info</h4>
                    <ul style="padding-left: 20px;">
                        <li>Dual-band GPS (L1/L2)</li>
                        <li>Bluetooth 4.0 vagy újabb</li>
                        <li>SPP (Serial Port Profile)</li>
                        <li>NMEA 0183 kimenet</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-bluetooth"></i> Eszköz Keresés és Elemzés</h2>
            
            <div class="data-display">
                <div class="data-item">
                    <span class="data-label">Bluetooth állapot:</span>
                    <span class="data-value" id="bluetoothStatus">Ellenőrzés...</span>
                </div>
                <div class="data-item">
                    <span class="data-label">Kiválasztott eszköz:</span>
                    <span class="data-value" id="selectedDevice">Nincs</span>
                </div>
                <div class="data-item">
                    <span class="data-label">Web API név:</span>
                    <span class="data-value" id="webApiName">-</span>
                </div>
                <div class="data-item">
                    <span class="data-label">Android név (becsült):</span>
                    <span class="data-value" id="androidName">-</span>
                </div>
                <div class="data-item">
                    <span class="data-label">Eszköz ID:</span>
                    <span class="data-value" id="deviceId">-</span>
                </div>
            </div>
            
            <button class="btn" id="scanBtn" style="width: 100%;">
                <i class="fas fa-search"></i> Bluetooth eszköz keresése és elemzése
            </button>
            
            <div class="hex-dump" id="hexDump" style="display: none;">
                <h4><i class="fas fa-code"></i> Nyers adatok hex dump</h4>
                <div id="hexContent"></div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-cogs"></i> Technikai háttér</h2>
            
            <h3><i class="fas fa-broadcast-tower"></i> Bluetooth Advertising Data szerkezete</h3>
            <p>A Bluetooth eszközök periodikusan küldenek reklámcsomagokat, amelyek több típusú adatot tartalmazhatnak:</p>
            
            <div class="device-info-grid">
                <div class="info-box">
                    <h4>1. Complete Local Name</h4>
                    <p>A teljes eszköznév (Android ezt jeleníti meg)</p>
                    <p><code>Length: 0x0D Type: 0x09 Value: "PXEB_FB13BDD6"</code></p>
                </div>
                
                <div class="info-box">
                    <h4>2. Shortened Local Name</h4>
                    <p>Rövidített név (Web API ezt kaphatja)</p>
                    <p><code>Length: 0x08 Type: 0x08 Value: "GR-AC_..."</code></p>
                </div>
                
                <div class="info-box">
                    <h4>3. Manufacturer Specific Data</h4>
                    <p>Gyártó specifikus adatok</p>
                    <p><code>Length: 0xXX Type: 0xFF Value: [custom data]</code></p>
                </div>
            </div>
            
            <h3 style="margin-top: 20px;"><i class="fas fa-question-circle"></i> Miért különbözik a két név?</h3>
            <ol style="padding-left: 20px; margin-top: 10px;">
                <li><strong>API különbségek:</strong> Android SDK és Web Bluetooth API eltérően interpretálja a reklámadatok</li>
                <li><strong>Adatprioritás:</strong> A modul több nevet küldhet, a kliens dönti melyiket jeleníti meg</li>
                <li><strong>Karakterkódolás:</strong> A Web API más kódolást feltételezhet</li>
                <li><strong>Firmware változat:</strong> Különböző firmware verziók különböző neveket küldhetnek</li>
            </ol>
            
            <h3 style="margin-top: 20px;"><i class="fas fa-wrench"></i> Gyakorlati megoldások</h3>
            <div class="device-info-grid">
                <div class="info-box">
                    <h4>1. Mindkét név elfogadása</h4>
                    <p>Az alkalmazásban ellenőrizd mindkét lehetséges nevet:</p>
                    <code>if(name.includes("PXEB") || name.includes("GR-AC"))</code>
                </div>
                
                <div class="info-box">
                    <h4>2. MAC cím alapú azonosítás</h4>
                    <p>Az eszköz ID alapján azonosítsd, ne a név alapján:</p>
                    <code>device.id.includes("FB13BDD6")</code>
                </div>
                
                <div class="info-box">
                    <h4>3. Név normalizálás</h4>
                    <p>Normalizáld a neveket a használathoz:</p>
                    <code>normalizedName = name.replace(/[^a-zA-Z0-9_-]/g, '')</code>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-code"></i> JavaScript kód a névelemzéshez</h2>
            
            <pre style="background-color: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; overflow-x: auto; font-family: 'Courier New', monospace; color: #ffd166;">
// PX1122R GPS modul nevelemző funkció
function analyzePX1122RName(deviceName, deviceId) {
    const analysis = {
        originalName: deviceName,
        deviceId: deviceId,
        isPX1122R: false,
        nameType: 'unknown',
        macAddress: '',
        firmwareVersion: '',
        displayName: deviceName
    };
    
    // 1. Android név minta: PXEB_FB13BDD6
    const androidPattern = /^(PXEB|PX1122)[-_]([A-F0-9]{8})$/i;
    const androidMatch = deviceName.match(androidPattern);
    
    if (androidMatch) {
        analysis.isPX1122R = true;
        analysis.nameType = 'android';
        analysis.macAddress = androidMatch[2];
        analysis.displayName = `PX1122R GPS (${androidMatch[2]})`;
        return analysis;
    }
    
    // 2. Web API név minta: GR-AC_10001_09_7e73_SC
    const webPattern = /^(GR[-_]AC)[-_](\d+)[-_](\d+)[-_]([a-f0-9]{4})[-_](SC|BT)/i;
    const webMatch = deviceName.match(webPattern);
    
    if (webMatch) {
        analysis.isPX1122R = true;
        analysis.nameType = 'web';
        analysis.firmwareVersion = `${webMatch[2]}.${webMatch[3]}`;
        analysis.macAddress = webMatch[4];
        analysis.displayName = `PX1122R GPS (v${analysis.firmwareVersion})`;
        return analysis;
    }
    
    // 3. MAC cím keresése az ID-ből
    const macFromId = deviceId.match(/([A-F0-9]{2}[-:]){5}[A-F0-9]{2}|[A-F0-9]{12}/i);
    if (macFromId) {
        analysis.macAddress = macFromId[0].replace(/[-:]/g, '').slice(-8);
    }
    
    // 4. PX1122R kulcsszavak alapján
    const px1122Keywords = ['PX1122', 'PXEB', 'GR-AC', 'GPS', 'GNSS'];
    const hasKeyword = px1122Keywords.some(keyword => 
        deviceName.toUpperCase().includes(keyword)
    );
    
    if (hasKeyword) {
        analysis.isPX1122R = true;
        analysis.nameType = 'keyword_match';
    }
    
    return analysis;
}

// Használat:
const deviceAnalysis = analyzePX1122RName("GR-AC_10001_09_7e73_SC", "fb:13:bd:d6:12:34");
console.log(deviceAnalysis);</pre>
        </div>
    </div>

    <script>
        // DOM elemek
        const bluetoothStatus = document.getElementById('bluetoothStatus');
        const selectedDevice = document.getElementById('selectedDevice');
        const webApiName = document.getElementById('webApiName');
        const androidName = document.getElementById('androidName');
        const deviceId = document.getElementById('deviceId');
        const scanBtn = document.getElementById('scanBtn');
        const hexDump = document.getElementById('hexDump');
        const hexContent = document.getElementById('hexContent');
        
        // Bluetooth támogatás ellenőrzése
        function checkBluetoothSupport() {
            if (!navigator.bluetooth) {
                bluetoothStatus.textContent = 'Nem támogatott';
                bluetoothStatus.style.color = '#ff6b6b';
                scanBtn.disabled = true;
                return false;
            }
            
            navigator.bluetooth.getAvailability().then(available => {
                if (available) {
                    bluetoothStatus.textContent = 'Elérhető';
                    bluetoothStatus.style.color = '#81c784';
                } else {
                    bluetoothStatus.textContent = 'Nem elérhető';
                    bluetoothStatus.style.color = '#ffd166';
                    scanBtn.disabled = true;
                }
            }).catch(error => {
                bluetoothStatus.textContent = 'Hiba: ' + error.message;
                bluetoothStatus.style.color = '#ff6b6b';
            });
            
            return true;
        }
        
        // Hex dump generálása
        function createHexDump(data) {
            if (!data) return '';
            
            let hexString = '';
            let asciiString = '';
            let result = '';
            
            // Adatok átalakítása
            if (typeof data === 'string') {
                for (let i = 0; i < data.length; i++) {
                    const charCode = data.charCodeAt(i);
                    hexString += charCode.toString(16).padStart(2, '0') + ' ';
                    asciiString += (charCode >= 32 && charCode <= 126) ? data.charAt(i) : '.';
                    
                    if ((i + 1) % 16 === 0 || i === data.length - 1) {
                        const address = i.toString(16).padStart(4, '0');
                        result += `<div class="hex-line">
                            <span class="hex-address">${address}</span>
                            <span class="hex-bytes">${hexString.padEnd(48, ' ')}</span>
                            <span class="hex-ascii">${asciiString}</span>
                        </div>`;
                        hexString = '';
                        asciiString = '';
                    }
                }
            } else if (data instanceof ArrayBuffer) {
                const view = new Uint8Array(data);
                for (let i = 0; i < view.length; i++) {
                    hexString += view[i].toString(16).padStart(2, '0') + ' ';
                    asciiString += (view[i] >= 32 && view[i] <= 126) ? 
                        String.fromCharCode(view[i]) : '.';
                    
                    if ((i + 1) % 16 === 0 || i === view.length - 1) {
                        const address = i.toString(16).padStart(4, '0');
                        result += `<div class="hex-line">
                            <span class="hex-address">${address}</span>
                            <span class="hex-bytes">${hexString.padEnd(48, ' ')}</span>
                            <span class="hex-ascii">${asciiString}</span>
                        </div>`;
                        hexString = '';
                        asciiString = '';
                    }
                }
            }
            
            return result;
        }
        
        // PX1122R névelemző funkció
        function analyzePX1122RName(deviceName, deviceId) {
            const analysis = {
                originalName: deviceName,
                deviceId: deviceId,
                isPX1122R: false,
                nameType: 'unknown',
                macAddress: '',
                firmwareVersion: '',
                displayName: deviceName,
                androidName: '',
                webApiName: deviceName
            };
            
            // 1. Android név minta: PXEB_FB13BDD6
            const androidPattern = /^(PXEB|PX1122)[-_]([A-F0-9]{8})$/i;
            const androidMatch = deviceName.match(androidPattern);
            
            if (androidMatch) {
                analysis.isPX1122R = true;
                analysis.nameType = 'android';
                analysis.macAddress = androidMatch[2];
                analysis.displayName = `PX1122R GPS (${androidMatch[2]})`;
                analysis.androidName = deviceName;
                analysis.webApiName = `GR-AC_10001_09_${androidMatch[2].toLowerCase()}_SC`;
                return analysis;
            }
            
            // 2. Web API név minta: GR-AC_10001_09_7e73_SC
            const webPattern = /^(GR[-_]AC)[-_](\d+)[-_](\d+)[-_]([a-f0-9]{4})[-_](SC|BT)/i;
            const webMatch = deviceName.match(webPattern);
            
            if (webMatch) {
                analysis.isPX1122R = true;
                analysis.nameType = 'web';
                analysis.firmwareVersion = `${webMatch[2]}.${webMatch[3]}`;
                analysis.macAddress = webMatch[4];
                analysis.displayName = `PX1122R GPS (v${analysis.firmwareVersion})`;
                analysis.androidName = `PXEB_${webMatch[4].toUpperCase()}DD6`;
                analysis.webApiName = deviceName;
                return analysis;
            }
            
            // 3. MAC cím keresése az ID-ből
            const macMatch = deviceId.match(/([A-F0-9]{2}[:-]){5}[A-F0-9]{2}|[A-F0-9]{12}/i);
            if (macMatch) {
                const mac = macMatch[0].replace(/[:-]/g, '').toLowerCase();
                analysis.macAddress = mac.slice(-8);
                
                // Ha van MAC cím, feltételezzük, hogy PX1122R
                if (mac.length >= 12) {
                    analysis.isPX1122R = true;
                    analysis.nameType = 'mac_based';
                    analysis.androidName = `PXEB_${mac.slice(-8).toUpperCase()}`;
                    analysis.webApiName = `GR-AC_10001_09_${mac.slice(-8, -4)}_SC`;
                    analysis.displayName = `PX1122R GPS (${mac.slice(-8).toUpperCase()})`;
                }
            }
            
            // 4. PX1122R kulcsszavak alapján
            const px1122Keywords = ['PX1122', 'PXEB', 'GR-AC', 'GPS', 'GNSS', 'BDD6', '7E73'];
            const hasKeyword = px1122Keywords.some(keyword => 
                deviceName.toUpperCase().includes(keyword)
            );
            
            if (hasKeyword) {
                analysis.isPX1122R = true;
                analysis.nameType = 'keyword_match';
            }
            
            return analysis;
        }
        
        // Bluetooth eszköz keresése
        async function scanAndAnalyzeDevice() {
            if (!checkBluetoothSupport()) return;
            
            try {
                scanBtn.disabled = true;
                scanBtn.innerHTML = '<i class="fas fa-sync fa-spin"></i> Keresés...';
                
                const options = {
                    acceptAllDevices: true,
                    optionalServices: ['battery_service', 'device_information']
                };
                
                const device = await navigator.bluetooth.requestDevice(options);
                
                if (device) {
                    // Eszköz információk megjelenítése
                    selectedDevice.textContent = device.name || 'Név nélküli eszköz';
                    selectedDevice.style.color = '#81c784';
                    
                    // Elemzés végrehajtása
                    const analysis = analyzePX1122RName(device.name, device.id);
                    
                    // Eredmények megjelenítése
                    webApiName.textContent = analysis.webApiName;
                    androidName.textContent = analysis.androidName || 'Ismeretlen';
                    deviceId.textContent = device.id || '-';
                    
                    // Hex dump generálása
                    const nameHex = createHexDump(device.name);
                    const idHex = createHexDump(device.id);
                    
                    hexContent.innerHTML = `
                        <h4>Eszköznév hex dump:</h4>
                        ${nameHex || '<p>Nincs adat</p>'}
                        <h4 style="margin-top: 20px;">Eszköz ID hex dump:</h4>
                        ${idHex || '<p>Nincs adat</p>'}
                        <h4 style="margin-top: 20px;">Elemzés eredménye:</h4>
                        <pre style="color: #ffd166;">${JSON.stringify(analysis, null, 2)}</pre>
                    `;
                    
                    hexDump.style.display = 'block';
                    
                    // Színezés az eredmény alapján
                    if (analysis.isPX1122R) {
                        webApiName.style.color = '#81c784';
                        androidName.style.color = '#81c784';
                    } else {
                        webApiName.style.color = '#ffd166';
                        androidName.style.color = '#ffd166';
                    }
                }
                
            } catch (error) {
                console.error('Hiba:', error);
                selectedDevice.textContent = 'Hiba: ' + error.message;
                selectedDevice.style.color = '#ff6b6b';
            } finally {
                scanBtn.disabled = false;
                scanBtn.innerHTML = '<i class="fas fa-search"></i> Bluetooth eszköz keresése és elemzése';
            }
        }
        
        // Inicializálás
        function init() {
            checkBluetoothSupport();
            scanBtn.addEventListener('click', scanAndAnalyzeDevice);
            
            // Példa elemzés bemutatása
            const exampleAnalysis = analyzePX1122RName("GR-AC_10001_09_7e73_SC", "fb:13:bd:d6:12:34");
            console.log('Példa elemzés:', exampleAnalysis);
        }
        
        // Alkalmazás indítása
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
