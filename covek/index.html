<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√∂vek Felm√©r√©s</title>
    
    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Leaflet Providers plugin -->
    <script src="https://unpkg.com/leaflet-providers@2.0.0/leaflet-providers.js"></script>
    
    <!-- Proj4.js -->
    <script src="https://unpkg.com/proj4@2.12.0/dist/proj4.js"></script>
    
    <!-- Leaflet-Proj4 plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-proj4/1.0.2/leaflet-proj4.umd.js"></script>
    
    <!-- JSZip √©s shpjs (shapefile) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://unpkg.com/shpjs@latest/dist/shp.js"></script>
    
    <!-- GeoTIFF.js - HD72 grid bet√∂lt√©shez sz√ºks√©ges -->
    <script src="https://cdn.jsdelivr.net/npm/geotiff@2.1.3/dist-browser/geotiff.js"></script>
    
    <!-- Local styles -->
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <!-- Hiba megjelen√≠t≈ë panel -->
    <div id="error-panel" class="error-panel" style="display: none;">
        <div class="error-content">
            <span id="error-icon">‚ö†Ô∏è</span>
            <div class="error-text">
                <div id="error-title"></div>
                <div id="error-message"></div>
                <div id="error-value"></div>
            </div>
            <button id="error-close" class="error-close" aria-label="Bez√°r√°s">‚úï</button>
        </div>
    </div>

    <div class="container">
        <div id="map">
            <!-- Koordin√°ta panel a t√©rk√©pen -->
            <div class="coord-panel">
                <div class="coord-row">
                    <div class="coord-label">ETRF2000</div>
                    <div class="coord-value">
                        <span id="latETRF">‚Äî</span>, <span id="lonETRF">‚Äî</span>
                    </div>
                </div>
                <div class="coord-row">
                    <div class="coord-label">EOV</div>
                    <div class="coord-value">
                        Y: <span id="eovY">‚Äî</span> X: <span id="eovX">‚Äî</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- M√©r√©si t√°vols√°g panel az alj√°n -->
        <div id="distance-info-panel" class="distance-info-panel" hidden>
            <div id="distance-text">‚Äî</div>
        </div>

        <!-- Poligon inform√°ci√≥s panel az alj√°n -->
        <div id="polygon-info-panel" class="polygon-info-panel" hidden>
            <div class="polygon-info-header">
                <strong>üìç Poligon</strong>
                <span id="polygon-area">‚Äî</span>
            </div>
            <div id="polygon-properties" class="polygon-properties">
                <!-- Properties dinamikusan jelennek meg -->
            </div>
        </div>
        
        <button class="hamburger" id="hamburgerBtn" aria-label="Men√º">
            <span></span>
            <span></span>
            <span></span>
        </button>
        
        <div class="sidebar" id="sidebar">
            <button class="sidebar-close" id="sidebarClose" aria-label="Bez√°r√°s">‚úï</button>
            <h2>üó∫Ô∏è c√∂vek</h2>
            <p style="margin: -15px 0 20px 0; font-size: 12px; color: #999; font-style: italic;">‚Äì √°ll mint a c√∂vek</p>
            
            <!-- Shapefile upload -->
            <div class="section">
                <label style="display: flex; align-items: center; gap: 8px;">
                    <h3 style="margin: 0;">üìÅ Geometria import</h3>
                    <button id="fileFormatHelpBtn" type="button" class="help-icon-btn" title="T√°mogatott f√°jlt√≠pusok" aria-label="T√°mogatott f√°jlt√≠pusok">
                        ?
                    </button>
                </label>
                <label for="shapeFile">ZIP (shapefile), SHP, vagy KML f√°jl</label>
                <input type="file" id="shapeFile" accept=".zip,.shp,.kml" />
                
                <label for="shapeFileProjection" style="display: flex; align-items: center; gap: 8px;">
                    Vet√ºlet
                    <button id="projectionHelpBtn" type="button" class="help-icon-btn" title="Vet√ºlet inform√°ci√≥" aria-label="Vet√ºlet inform√°ci√≥">
                        ?
                    </button>
                </label>
                <select id="shapeFileProjection">
                    <option value="wgs84">WGS84</option>
                    <option value="etrf2000">ETRF2000</option>
                    <option value="eov" selected>EOV</option>
                </select>
                <div id="shapeFileStatus"></div>
            </div>

            <!-- Forr√°s kiv√°laszt√°sa -->
            <div class="section">
                <h3>üì° Forr√°s</h3>
                <label for="gpsSource" style="display: flex; align-items: center; gap: 8px;">
                    Kiv√°lasztott forr√°s
                    <button id="sourceHelpBtn" type="button" class="help-icon-btn" title="Forr√°s inform√°ci√≥" aria-label="Forr√°s inform√°ci√≥">
                        ?
                    </button>
                </label>
                <select id="gpsSource">
                    <option value="wgs84">WGS84 GPS</option>
                    <option value="rtk">ETRF2000 RTK</option>
                    <option value="screenCenter">T√©rk√©p k√∂z√©ppontja</option>
                </select>
            </div>

            <!-- Auto zoom -->
            <div class="section">
                <h3>üîç Megjelen√≠t√©s</h3>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="autoZoomEnable" style="margin-right: 8px;">
                    <span>Auto zoom m≈±holdn√©zethez</span>
                </label>
            </div>

            <!-- Grid Status -->
            <div class="section">
                <h3>üõ∞Ô∏è Grid st√°tusz</h3>
                <div id="gridStatus" style="font-size: 13px; line-height: 1.6;">
                    <div><strong>Pontoss√°g:</strong> <span id="gridAccuracy">‚Äî</span></div>
                    <div><strong>Forr√°s:</strong> <span id="gridSource">‚Äî</span></div>
                </div>
            </div>

            <!-- About -->
            <div class="section about-section">
                <h3>‚ÑπÔ∏è N√©vjegy</h3>
                <p>
                    <strong>C√∂vek</strong><br>
                    EOV koordin√°ta transzform√°ci√≥s √©s shapefile feldolgoz√≥ alkalmaz√°s
                </p>
                <p>
                    <strong>K√©sz√≠tette:</strong> Mr. Poke<br>
                    üìß <a href="mailto:mrpoke21@gmail.com">mrpoke21@gmail.com</a>
                </p>
                <p style="font-size: 12px; color: #999; margin-top: 12px;">
                    <strong>T√°mogatta:</strong> GitHub Copilot AI Assistant<br>
                    Az alkalmaz√°s fejleszt√©s√©ben mesters√©ges intelligencia seg√©dlettel k√©sz√ºlt k√≥doptimaliz√°l√°s, refaktor√°l√°s √©s felhaszn√°l√≥i interf√©sz fejleszt√©s ter√©n.
                </p>
            </div>
        </div>
    </div>

    <!-- Vet√ºlet inform√°ci√≥s modal -->
    <div id="projectionModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ÑπÔ∏è Vet√ºlet inform√°ci√≥</h2>
                <button class="modal-close" id="projectionModalClose" type="button" aria-label="Bez√°r√°s">‚úï</button>
            </div>
            <div class="modal-body">
                <p><strong>Mit kell ezzel csin√°lni?</strong></p>
                <p>A felt√∂lteni k√≠v√°nt <strong>shapefile-ban t√°rolt koordin√°t√°k vet√ºlet√©t kell megadni</strong>. Ez a f√°jl metaadataiban vagy dokument√°ci√≥j√°ban szerepel.</p>
                
                <p><strong>üó∫Ô∏è Vet√ºlet t√≠pusok:</strong></p>
                <ul>
                    <li><strong>EOV</strong> ‚Äì Magyarorsz√°g Egys√©ges Vet√ºleti Rendszere (1975). Ez a <strong>leggyakoribb</strong> v√°laszt√°s magyar shapefile-ok eset√©n.</li>
                    <li><strong>ETRF2000</strong> ‚Äì Eur√≥pai referencia rendszer. K√∂zvetlen√ºl haszn√°lhat√≥ EOV sz√ºl≈ërendszerk√©nt.</li>
                    <li><strong>WGS84</strong> ‚Äì GPS standart. <strong>Nagyon ritk√°n</strong> fordul el≈ë magyar adatok eset√©n.</li>
                </ul>
                
                <p><strong>‚ö†Ô∏è Hib√°s vet√ºlet v√°laszt√°sa eset√©n:</strong></p>
                <p>Sikertelen koordin√°ta-transzform√°ci√≥ vagy lehets√©ges Java hiba g√°tolhatja a felt√∂lt√©st. Ha ez megt√∂rt√©nik:</p>
                <ol>
                    <li>A ZIP-f√°jlb√≥l <strong>t√∂r√∂ld ki a .prj f√°jlt</strong> (az EOV vet√ºleti defin√≠ci√≥j√°t tartalmazza, mely √ºtk√∂zhet egy m√°sik vet√ºlettel)</li>
                    <li>Pr√≥b√°ld meg √∫jra felt√∂lteni a m√≥dos√≠tott ZIP f√°jlt</li>
                </ol>
                
                <p><strong>üí° Tipp:</strong> Ha nem vagy biztos, a .prj f√°jlt sz√∂vegeditorban megnyitva megtekintheted az aktu√°lis vet√ºleti defin√≠ci√≥t.</p>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" id="projectionModalOK" type="button">Rendben</button>
            </div>
        </div>
    </div>

    <!-- F√°jl form√°tum inform√°ci√≥s modal -->
    <div id="fileFormatModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ÑπÔ∏è T√°mogatott f√°jlt√≠pusok</h2>
                <button class="modal-close" id="fileFormatModalClose" type="button" aria-label="Bez√°r√°s">‚úï</button>
            </div>
            <div class="modal-body">
                <p><strong>Ez az alkalmaz√°s h√°rom f√°jlt√≠pust t√°mogat:</strong></p>
                
                <p><strong>üì¶ ZIP (Shapefile)</strong></p>
                <p>A shapefile h√°rom file-b√≥l √°ll, amelyet egy ZIP-be kell csomagolni:</p>
                <ul>
                    <li><strong>.shp</strong> ‚Äì geometria (pontok, vonalak, poligonok)</li>
                    <li><strong>.shx</strong> ‚Äì index f√°jl (gyors hozz√°f√©r√©shez sz√ºks√©ges)</li>
                    <li><strong>.dbf</strong> ‚Äì attrib√∫tum adatok (opcion√°lis)</li>
                </ul>
                <p>üéØ <strong>Aj√°nlott form√°tum:</strong> Ez a legstabilabb √©s legz√°rtabb megold√°s.</p>
                
                <p><strong>üìÑ SHP (t√∂m√∂r√≠tetlen shapefile)</strong></p>
                <p>Ha csak az egyedi <strong>.shp f√°jlt</strong> t√∂lt√∂d fel, az alkalmaz√°s automatikusan:</p>
                <ul>
                    <li>Gener√°l egy dummy <strong>.dbf</strong> f√°jlt</li>
                    <li>ZIP-be csomagol mindkett≈ët</li>
                    <li>Feldolgozza a geometri√°t</li>
                </ul>
                <p>‚ö†Ô∏è <strong>Megjegyz√©s:</strong> Az attrib√∫tum adatok (n√©v, ter√ºlet, stb.) az info panelben nem jelennek meg.</p>
                
                <p><strong>üó∫Ô∏è KML (Keyhole Markup Language)</strong></p>
                <p>XML-alap√∫ form√°tum, amely tartalmaz:</p>
                <ul>
                    <li>Point (pontok) ‚Äì GPS koordin√°t√°kkal</li>
                    <li>LineString (vonalak)</li>
                    <li>Polygon (poligonok) ‚Äì bels≈ë hat√°rokkal is</li>
                    <li>N√©veket √©s le√≠r√°sokat</li>
                </ul>
                <p>‚úÖ <strong>El≈ënye:</strong> K√∂nnyen kezelhet≈ë, gyakran haszn√°lt t√©rk√©p alkalmaz√°sokban (Google Maps, stb.)</p>
                
                <p><strong>üí° Koordin√°ta rendszer:</strong></p>
                <p>Az √∂sszes f√°jlt√≠pus eset√©n meg kell adni a <strong>bemeneti vet√ºletet</strong> (vet√ºlet selektor). Az alkalmaz√°s automatikusan EOV-ra transzform√°lja a koordin√°t√°kat.</p>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" id="fileFormatModalOK" type="button">Rendben</button>
            </div>
        </div>
    </div>

    <!-- Forr√°s inform√°ci√≥s modal -->
    <div id="sourceModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ÑπÔ∏è Forr√°s inform√°ci√≥</h2>
                <button class="modal-close" id="sourceModalClose" type="button" aria-label="Bez√°r√°s">‚úï</button>
            </div>
            <div class="modal-body">
                <p><strong>Mit kell ezzel csin√°lni?</strong></p>
                <p>V√°laszd ki a koordin√°ta adatok <strong>forr√°srendszer√©t</strong> ‚Äì ahonnan az aktu√°lis poz√≠ci√≥dat szeretn√©d meghat√°rozni.</p>
                
                <p><strong>üì° Forr√°s t√≠pusok:</strong></p>
                <ul>
                    <li><strong>ETRF2000 RTK</strong> ‚Äì Val√≥s idej≈± kinematikus GNSS, fix megold√°s. <strong>RTK fix eset√©n ezt kell v√°lasztani.</strong> Centim√©teres pontoss√°g Magyarorsz√°g felett.</li>
                    <li><strong>WGS84 GPS</strong> ‚Äì Standard vagy h√°l√≥zati korrekci√≥s DGNSS, PPP stb. <strong>Ha m√°s korrekci√≥s m√≥dszert haszn√°lsz (D*GNSS, PPP, stb.), ezt v√°laszd.</strong> Decim√©teres pontoss√°g.</li>
                    <li><strong>T√©rk√©p k√∂z√©ppontja</strong> ‚Äì A t√©rk√©pen megjelen√≠tett ter√ºlet k√∂z√©ppontja. <strong>Tesztel√©sre √©s tanul√°sra</strong> haszn√°lhat√≥, ha nincs val√≥s GPS adatod.</li>
                </ul>
                
                <p><strong>üí° Tipp:</strong> Ha RTK vev≈ëvel dolgozol, az ETRF2000 RTK az aj√°nlott. Egy√©b esetekben a WGS84 GPS lehet≈ës√©g felel meg a legt√∂bb felhaszn√°l√°si esetnek.</p>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" id="sourceModalOK" type="button">Rendben</button>
            </div>
        </div>
    </div>

    <script src="logger.js"></script>
    <script src="validation.js"></script>
    <script src="eov-transformer.js"></script>
    <script src="mepar-layers.js"></script>
    <script src="mathematics.js"></script>
    <script src="ui-controls.js"></script>
    <script src="script.js"></script>
</body>
</html>
